<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Odoo Open Treasures (Posts about upgrade)</title><link>http://blog.odooist.com/</link><description></description><atom:link href="http://blog.odooist.com/categories/upgrade.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2021 &lt;a href="mailto:odooist@gmail.com"&gt;Odooist&lt;/a&gt; </copyright><lastBuildDate>Sun, 10 Jan 2021 12:13:28 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Detect upgrade procedure</title><link>http://blog.odooist.com/posts/detect-upgrade-procedure/</link><dc:creator>Odooist</dc:creator><description>&lt;div&gt;&lt;p&gt;In Odoo it is possible to define model records in XML data files.&lt;/p&gt;
&lt;p&gt;During module upgrade procedure Odoo reads XML datafiles and updates database records defined there.&lt;/p&gt;
&lt;p&gt;But what if we need to have a conditional update? So that we do not update the records if
some condition is not met.&lt;/p&gt;
&lt;p&gt;To have this done we need to redefine &lt;em&gt;write&lt;/em&gt; method for the model and put there the following:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;vals&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-2"&gt;&lt;/a&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;rec&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-3"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'install_mode'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-4"&gt;&lt;/a&gt;                &lt;span class="s1"&gt;'module'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'your_module_name'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-5"&gt;&lt;/a&gt;            &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'We are in upgrade procedure!'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-6"&gt;&lt;/a&gt;            &lt;span class="c1"&gt;# Check a condition&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-7"&gt;&lt;/a&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-8"&gt;&lt;/a&gt;                &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Ignoring updated record.'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-9"&gt;&lt;/a&gt;            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-10"&gt;&lt;/a&gt;                &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MyCustomModel&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_02c2db9eb28b420f9af7372ed6a04a2b-11"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><category>upgrade</category><category>xml</category><guid>http://blog.odooist.com/posts/detect-upgrade-procedure/</guid><pubDate>Sun, 10 Jan 2021 12:00:27 GMT</pubDate></item></channel></rss>