<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Odoo Open Treasures (Posts about i18n)</title><link>http://blog.odooist.com/</link><description></description><atom:link href="http://blog.odooist.com/categories/i18n.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2019 &lt;a href="mailto:odooist@gmail.com"&gt;Odooist&lt;/a&gt; </copyright><lastBuildDate>Sat, 28 Dec 2019 13:48:14 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>How to set language for controller</title><link>http://blog.odooist.com/posts/how-to-set-language-for-controller/</link><dc:creator>Odooist</dc:creator><description>&lt;div&gt;&lt;p&gt;Imagine that you have a signup procedure, like this:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MobileAppBaseController&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Controller&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-2"&gt;&lt;/a&gt;  &lt;span class="nd"&gt;@http.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/barrier/verify_user/1'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'json'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'public'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-3"&gt;&lt;/a&gt;              &lt;span class="n"&gt;methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'POST'&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;csrf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-4"&gt;&lt;/a&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;verify_user_step_1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-5"&gt;&lt;/a&gt;      &lt;span class="n"&gt;user_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;jsonrequest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'username'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-6"&gt;&lt;/a&gt;      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;user_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-7"&gt;&lt;/a&gt;          &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;'status'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'msg'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'User name not sent.'&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;a name="rest_code_dffdd4b638c9456d89b1c0f7dbd61622-8"&gt;&lt;/a&gt;      &lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;When user name is not specified in JSON request it returns 'User name not sent' message.&lt;/p&gt;
&lt;p&gt;Now we want this message to be returned in different languages.&lt;/p&gt;
&lt;p&gt;After learning fron &lt;em&gt;odoo/tools/translation.py&lt;/em&gt; and &lt;em&gt;odoo/http.py&lt;/em&gt; two solutions where found.&lt;/p&gt;
&lt;div class="section" id="language-selection-by-client"&gt;
&lt;h2&gt;1. Language selection by client&lt;/h2&gt;
&lt;p&gt;To request messages translated into specified language Accept-Language header is used:&lt;/p&gt;
&lt;pre class="code sh"&gt;&lt;a name="rest_code_a81d41ce1073403aa20d236c1e7ecc7a-1"&gt;&lt;/a&gt;http -vv --json &lt;span class="s1"&gt;'http://127.0.0.1:38069/barrier/verify_user/1'&lt;/span&gt; &lt;span class="s2"&gt;"_username=user"&lt;/span&gt; &lt;span class="s1"&gt;'Accept-Language:ru'&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;Result:&lt;/p&gt;
&lt;pre class="code sh"&gt;&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-1"&gt;&lt;/a&gt;odooist@MacBook-Pro app % http -v --json &lt;span class="s1"&gt;'http://127.0.0.1:38069/barrier/verify_user/1'&lt;/span&gt; &lt;span class="s2"&gt;"_username=user"&lt;/span&gt; &lt;span class="s1"&gt;'Accept-Language:ru'&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-2"&gt;&lt;/a&gt;POST /barrier/verify_user/1 HTTP/1.1
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-3"&gt;&lt;/a&gt;Accept: application/json, */*
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-4"&gt;&lt;/a&gt;Accept-Encoding: gzip, deflate
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-5"&gt;&lt;/a&gt;Accept-Language: ru
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-6"&gt;&lt;/a&gt;Connection: keep-alive
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-7"&gt;&lt;/a&gt;Content-Length: &lt;span class="m"&gt;21&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-8"&gt;&lt;/a&gt;Content-Type: application/json
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-9"&gt;&lt;/a&gt;Host: &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1:38069
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-10"&gt;&lt;/a&gt;User-Agent: HTTPie/1.0.3
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-11"&gt;&lt;/a&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-12"&gt;&lt;/a&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-13"&gt;&lt;/a&gt;    &lt;span class="s2"&gt;"_username"&lt;/span&gt;: &lt;span class="s2"&gt;"user"&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-14"&gt;&lt;/a&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-15"&gt;&lt;/a&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-16"&gt;&lt;/a&gt;HTTP/1.0 &lt;span class="m"&gt;200&lt;/span&gt; OK
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-17"&gt;&lt;/a&gt;Content-Length: &lt;span class="m"&gt;224&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-18"&gt;&lt;/a&gt;Content-Type: application/json
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-19"&gt;&lt;/a&gt;Date: Sat, &lt;span class="m"&gt;28&lt;/span&gt; Dec &lt;span class="m"&gt;2019&lt;/span&gt; &lt;span class="m"&gt;11&lt;/span&gt;:33:49 GMT
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-20"&gt;&lt;/a&gt;Server: Werkzeug/0.16.0 Python/3.5.3
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-21"&gt;&lt;/a&gt;Set-Cookie: &lt;span class="nv"&gt;session_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;7b62bc401c248052e8a0ffb7626b7122340f774a&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;Expires&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;Fri, &lt;span class="m"&gt;27&lt;/span&gt;-Mar-2020 &lt;span class="m"&gt;11&lt;/span&gt;:33:49 GMT&lt;span class="p"&gt;;&lt;/span&gt; Max-Age&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;7776000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; HttpOnly&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;Path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-22"&gt;&lt;/a&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-23"&gt;&lt;/a&gt;&lt;span class="o"&gt;{&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-24"&gt;&lt;/a&gt;  &lt;span class="s2"&gt;"id"&lt;/span&gt;: null,
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-25"&gt;&lt;/a&gt;  &lt;span class="s2"&gt;"jsonrpc"&lt;/span&gt;: &lt;span class="s2"&gt;"2.0"&lt;/span&gt;,
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-26"&gt;&lt;/a&gt;  &lt;span class="s2"&gt;"result"&lt;/span&gt;: &lt;span class="o"&gt;{&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-27"&gt;&lt;/a&gt;      &lt;span class="s2"&gt;"msg"&lt;/span&gt;: &lt;span class="s2"&gt;"Имя пользователя не отослано."&lt;/span&gt;,
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-28"&gt;&lt;/a&gt;      &lt;span class="s2"&gt;"status"&lt;/span&gt;: &lt;span class="nb"&gt;false&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-29"&gt;&lt;/a&gt;  &lt;span class="o"&gt;}&lt;/span&gt;
&lt;a name="rest_code_c98b04c3539245a98816f9a10ddb8c4d-30"&gt;&lt;/a&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;As you can see in request headers Accept-Language is set to &lt;em&gt;ru&lt;/em&gt;, and in result we got msg translated.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="define-response-language-at-server"&gt;
&lt;h2&gt;2. Define response language at server&lt;/h2&gt;
&lt;p&gt;In &lt;em&gt;odoo/tools/translation.py&lt;/em&gt; interesting code was found:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_get_lang&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-2"&gt;&lt;/a&gt;    &lt;span class="c1"&gt;# try, in order: context.get('lang'), kwargs['context'].get('lang'),&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-3"&gt;&lt;/a&gt;    &lt;span class="c1"&gt;# self.env.lang, self.localcontext.get('lang'), request.env.lang&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-4"&gt;&lt;/a&gt;    &lt;span class="n"&gt;lang&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-5"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;f_locals&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'context'&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-6"&gt;&lt;/a&gt;        &lt;span class="n"&gt;lang&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;f_locals&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'context'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'lang'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-7"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-8"&gt;&lt;/a&gt;        &lt;span class="n"&gt;kwargs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;f_locals&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'kwargs'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{})&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-9"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'context'&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-10"&gt;&lt;/a&gt;            &lt;span class="n"&gt;lang&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'context'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'lang'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-11"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-12"&gt;&lt;/a&gt;        &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;f_locals&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'self'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-13"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;hasattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'env'&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-14"&gt;&lt;/a&gt;            &lt;span class="n"&gt;lang&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lang&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-15"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-16"&gt;&lt;/a&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;hasattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'localcontext'&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-17"&gt;&lt;/a&gt;                &lt;span class="n"&gt;lang&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localcontext&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'lang'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-18"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-19"&gt;&lt;/a&gt;            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-20"&gt;&lt;/a&gt;                &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;odoo.http&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-21"&gt;&lt;/a&gt;                &lt;span class="n"&gt;lang&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lang&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-22"&gt;&lt;/a&gt;            &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;RuntimeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-23"&gt;&lt;/a&gt;                &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-24"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-25"&gt;&lt;/a&gt;            &lt;span class="c1"&gt;# Last resort: attempt to guess the language of the user&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-26"&gt;&lt;/a&gt;            &lt;span class="c1"&gt;# Pitfall: some operations are performed in sudo mode, and we&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-27"&gt;&lt;/a&gt;            &lt;span class="c1"&gt;#          don't know the original uid, so the language may&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-28"&gt;&lt;/a&gt;            &lt;span class="c1"&gt;#          be wrong when the admin language differs.&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-29"&gt;&lt;/a&gt;            &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dummy&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_get_cr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;allow_create&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-30"&gt;&lt;/a&gt;            &lt;span class="n"&gt;uid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_get_uid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-31"&gt;&lt;/a&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;cr&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-32"&gt;&lt;/a&gt;                &lt;span class="n"&gt;env&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;odoo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;api&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Environment&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{})&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-33"&gt;&lt;/a&gt;                &lt;span class="n"&gt;lang&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'res.users'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;context_get&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="s1"&gt;'lang'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;a name="rest_code_43bbe7e098114a0599efe7a694f44c68-34"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;lang&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;So to define server response language we had to put a context dictionary on a
function level like this (line 5):&lt;/p&gt;
&lt;table class="codetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-1"&gt;1&lt;/a&gt;
&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-2"&gt;2&lt;/a&gt;
&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-3"&gt;3&lt;/a&gt;
&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-4"&gt;4&lt;/a&gt;
&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-5"&gt;5&lt;/a&gt;
&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-6"&gt;6&lt;/a&gt;
&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-7"&gt;7&lt;/a&gt;
&lt;a href="http://blog.odooist.com/posts/how-to-set-language-for-controller/#rest_code_173df031def64d8097e798c573744558-8"&gt;8&lt;/a&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre class="code python"&gt;&lt;a name="rest_code_173df031def64d8097e798c573744558-1"&gt;&lt;/a&gt;   &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MobileAppBaseController&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Controller&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_173df031def64d8097e798c573744558-2"&gt;&lt;/a&gt;     &lt;span class="nd"&gt;@http.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/barrier/verify_user/1'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'json'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'public'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a name="rest_code_173df031def64d8097e798c573744558-3"&gt;&lt;/a&gt;                 &lt;span class="n"&gt;methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'POST'&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;csrf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_173df031def64d8097e798c573744558-4"&gt;&lt;/a&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;verify_user_step_1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_173df031def64d8097e798c573744558-5"&gt;&lt;/a&gt;         &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;'language'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'ru_RU'&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;a name="rest_code_173df031def64d8097e798c573744558-6"&gt;&lt;/a&gt;         &lt;span class="n"&gt;user_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;jsonrequest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'username'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_173df031def64d8097e798c573744558-7"&gt;&lt;/a&gt;         &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;user_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_173df031def64d8097e798c573744558-8"&gt;&lt;/a&gt;             &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;'status'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'msg'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'User name not sent.'&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;&lt;strong&gt;Notice&lt;/strong&gt; that in the first case we added &lt;em&gt;Accept-Language: ru&lt;/em&gt;, but in the second one we
set language to &lt;em&gt;ru_RU&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description><category>controller</category><category>i18n</category><guid>http://blog.odooist.com/posts/how-to-set-language-for-controller/</guid><pubDate>Sat, 28 Dec 2019 11:25:16 GMT</pubDate></item></channel></rss>